# DevOps - Dev Stack

Cette section contient un docker compose all-in-one pour lancer un environnement de developpement et tester les fonctionnalitÃ© de vos astres Kosmos.

Remplissez juste le fichier .env avec les mots de passe souhaiitÃ©s

Cette stack Docker Compose fournit un environnement complet pour le dÃ©veloppement dâ€™applications .NET incluant :

- **MSSQL Server 2025**
- **Redis 8.2**
- **Keycloak**
- **RabbitMQ (avec management UI)**
- **HashiCorp Vault**
- **Mailpit (SMTP + API HTTP + UI)**

Tous les services utilisent **des volumes nommÃ©s** pour un stockage persistant compatible Portainer (aucune dÃ©pendance aux dossiers hÃ´tes).

---

## ğŸ“¦ Contenu

## Services

| Service     | Port local | Description |
|-------------|------------|-------------|
| MSSQL       | 1433       | Base de donnÃ©es SQL Server 2025 |
| Redis       | 6379       | Cache / PubSub |
| Keycloak    | 8080       | Identity & Access Management |
| RabbitMQ    | 15672 / 5672 | Broker de messages |
| Vault       | 8200       | Secret manager |
| Mailpit     | 8025 / 1025 | SMTP fake + API HTTP pour tests dâ€™email |

---

## ğŸš€ Lancer la stack

Placez un fichier `.env` (fourni dans ce repo) puis lancez :

```bash
docker compose up -d
```

Ou via Portainer â†’ Stacks â†’ Add â†’ Upload docker-compose.yml.

ğŸ” Configuration des services
MSSQL

Login :

user : sa

password : dÃ©fini dans .env (par dÃ©faut : YourStr0ngDevPass!)

Redis

Accessible sur :

localhost:6379

Keycloak

UI disponible sur :

ğŸ‘‰ http://localhost:8080

Credentials :

User : admin

Password : admin

RabbitMQ

Management UI :
ğŸ‘‰ http://localhost:15672

Default login : guest / guest

Vault

UI Web :
ğŸ‘‰ http://localhost:8200

Au premier lancement :

Cliquez sur Initialize

SÃ©lectionnez :

Secret shares: 1

Secret threshold: 1

Sauvegardez le Unseal Key et le Root Token

Cliquez sur Unseal

Vault restera utilisable tant que le conteneur ne redÃ©marre pas.

Mailpit (SMTP + API HTTP)
UI Web :

ğŸ‘‰ http://localhost:8025

SMTP (pour votre app .NET)
host: localhost
port: 1025
SSL: false

API HTTP (FOSS alternative Ã  SendGrid/Mailgun)

Envoyer un email :

POST http://localhost:8025/api/v1/messages
Content-Type: application/json

{
  "from": "test@example.com",
  "to": ["demo@example.com"],
  "subject": "Hello",
  "text": "Message via HTTP API"
}

ğŸ›  Fichier .env

Le fichier .env fourni contient des valeurs par dÃ©faut fonctionnelles pour le dÃ©veloppement.

Vous pouvez ajuster les ports et mots de passe sans modifier le docker-compose.yml.

ğŸ“ Volumes persistants

Tous les services utilisent des volumes nommÃ©s :

mssql-data
redis-data
keycloak-data
rabbitmq-data
vault-data
mailpit-data

Pour les supprimer totalement :

docker compose down -v

ğŸ§© Notes

Vault est en mode file storage, adaptÃ© pour le dÃ©veloppement.

Lâ€™unseal automatique nâ€™est volontairement pas inclus (unseal manuel via lâ€™UI).

Mailpit remplace MailHog : API HTTP + UI moderne + FOSS.

Aucun secret de production ne doit Ãªtre utilisÃ© dans ce stack.
